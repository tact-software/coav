# UI/UX設計書

## 概要

既存のビューモードUIを拡張し、サイドパネルにモード切替機能を統合する。
既存のタブ構造を最大限活用し、モード専用タブを追加する。

## アプリケーションモード

### モード定義

| モード | 説明 | 必要条件 |
|--------|------|----------|
| 通常モード | 既存のビューア機能 | なし |
| 比較モード | アノテーション比較・差分表示 | 比較ファイルの選択 |
| アノテーションモード | アノテーション作成・編集 | プロジェクトが開いていること |

### モード間の排他関係

- 通常モードは常に利用可能
- 比較モードとアノテーションモードは排他（同時に使用不可）

## モード切替UI

### サイドパネル上部に配置

```
┌─────────────────────────────────────┐
│  [通常] [比較] [アノテーション]      │
├─────────────────────────────────────┤
│  [コントロール] [情報] [詳細] ...   │
├─────────────────────────────────────┤
│                                     │
│  タブ内容                           │
│                                     │
└─────────────────────────────────────┘
```

### モードボタンの状態

| 状態 | 表示 |
|------|------|
| 通常 | グレー背景 |
| ホバー | 薄い青背景 |
| 選択中 | 青背景、下線 |
| 無効 | 薄いグレー、操作不可 |

### 無効状態の条件

- **アノテーションモード**: プロジェクトが開いていない時
- **比較モード**: アノテーションモード中

## タブ構成

### 既存タブ（5つ）

| タブ | 説明 |
|------|------|
| コントロール | 表示設定、ズーム、検索 |
| 情報 | 画像情報、統計情報 |
| 詳細 | 選択アノテーションの詳細 |
| ファイル | ファイル操作 |
| ナビゲーション | 画像一覧、フォルダナビゲーション |

### 新規追加タブ（2つ）

| タブ | 説明 |
|------|------|
| 比較 | 比較モード専用の操作パネル |
| アノテーション | アノテーション一覧、編集操作 |

### モード別タブ表示

| タブ | 通常モード | 比較モード | アノテーションモード |
|------|:----------:|:----------:|:--------------------:|
| コントロール | ○ | - | ○ |
| 情報 | ○ | ○ | ○ |
| 詳細 | ○ | ○ | ○ |
| ファイル | ○ | ○ | ○ |
| ナビゲーション | ○ | ○ | ○ |
| 比較 | - | ○ | - |
| アノテーション | - | - | ○ |

## 比較タブ（新設）

現在コントロールタブにある比較関連の操作を移行。

```
┌─────────────────────────────────────┐
│ 比較設定                            │
├─────────────────────────────────────┤
│ 比較ファイル:                       │
│ ┌─────────────────────┐ [選択...]  │
│ │ annotations_v2.json │            │
│ └─────────────────────┘            │
│                                     │
│ IoU閾値: [0.5 ▼]                   │
│                                     │
│ カテゴリマッピング:                 │
│ ┌─────────────────────────────┐    │
│ │ 人物 → 人物, 歩行者         │    │
│ │ 車 → 車                     │    │
│ └─────────────────────────────┘    │
│ [マッピング編集...]                 │
│                                     │
├─────────────────────────────────────┤
│ 表示フィルタ:                       │
│ [✓] True Positive (GT)             │
│ [✓] True Positive (Pred)           │
│ [✓] False Positive                 │
│ [✓] False Negative                 │
│                                     │
├─────────────────────────────────────┤
│ 統計:                               │
│ TP: 45  FP: 12  FN: 8              │
│ Precision: 0.789                    │
│ Recall: 0.849                       │
└─────────────────────────────────────┘
```

## アノテーションタブ（新設）

### 構成

```
┌─────────────────────────────────────┐
│ プロジェクト: サンプルプロジェクト   │
│ [プロジェクト設定...]               │
├─────────────────────────────────────┤
│ カテゴリ: [● 人物 (1)         ▼]   │
├─────────────────────────────────────┤
│ アノテーション一覧                  │
│ 🔍 検索...                          │
├─────────────────────────────────────┤
│ □ #1 ● 人物         [👁] [🗑]       │
│ ■ #2 ● 車           [👁] [🗑]       │
│ □ #3 ● 人物         [👁] [🗑]       │
├─────────────────────────────────────┤
│ 選択: 1件                           │
│ [削除] [複製]                        │
└─────────────────────────────────────┘
```

### 機能

- プロジェクト情報表示
- カテゴリ選択（描画時のデフォルト）
- アノテーション一覧
  - チェックボックスで選択状態表示
  - カテゴリ色を表示
  - 表示/非表示トグル
  - 削除ボタン
  - ドラッグ＆ドロップで順序変更
- 選択アノテーションの一括操作

## アノテーションツールバー

### 配置

キャンバス上部に水平配置（アノテーションモード時のみ表示）

```
┌─────────────────────────────────────────────────────────────────┐
│ [↖ 選択] [□ BBox] [⬡ ポリゴン] │ [↩ Undo] [↪ Redo] │ [💾 保存] │
└─────────────────────────────────────────────────────────────────┘
```

### ツールボタン

- アイコン + テキスト（設定でアイコンのみに変更可能）
- 選択中のツールはハイライト表示
- ツールチップでショートカットキーを表示

### ボタン状態

| 状態 | 表示 |
|------|------|
| 通常 | グレー背景 |
| ホバー | 薄い青背景 |
| 選択中 | 青背景 |
| 無効 | 薄いグレー、操作不可 |

## 詳細タブの拡張

アノテーションモード時、選択中のアノテーション詳細を編集可能に。

### 通常モード・比較モード時（既存）

```
┌─────────────────────────────────────┐
│ アノテーション #1                    │
├─────────────────────────────────────┤
│ カテゴリ: 人物                       │
│ タイプ: バウンディングボックス       │
│ 位置: (120, 80)                     │
│ サイズ: 200 x 300                   │
│ 面積: 60,000 px²                    │
└─────────────────────────────────────┘
```

### アノテーションモード時（編集可能）

```
┌─────────────────────────────────────┐
│ アノテーション #1                    │
├─────────────────────────────────────┤
│ カテゴリ: [人物 ▼]                  │
│ タイプ: バウンディングボックス       │
│ 位置: (120, 80)                     │
│ サイズ: 200 x 300                   │
│ 面積: 60,000 px²                    │
├─────────────────────────────────────┤
│ [削除] [複製]                        │
└─────────────────────────────────────┘
```

## キャンバス表示

### アノテーション表示

#### 通常状態

- 既存のビューモードと同じ表示
- カテゴリ色で塗りつぶし（半透明）
- 枠線

#### 選択状態（アノテーションモード時）

- 青色の枠線（太め）
- リサイズハンドル表示

#### ホバー状態（アノテーションモード時）

- カーソル変更
- 薄いハイライト

### カーソル（アノテーションモード時）

| 状態 | カーソル |
|------|---------|
| 選択ツール（通常） | default |
| 選択ツール（アノテーション上） | pointer |
| 選択ツール（移動中） | move |
| BBoxツール | crosshair |
| ポリゴンツール | crosshair |
| リサイズハンドル上 | 方向に応じたresize |

### 描画中のプレビュー

- 半透明の図形でプレビュー
- 寸法表示（ツールチップ）

## ダイアログ

### プロジェクト作成ダイアログ

```
┌─────────────────────────────────────────────────────┐
│ 新規プロジェクト                              [×]  │
├─────────────────────────────────────────────────────┤
│                                                     │
│ プロジェクト名:                                     │
│ ┌─────────────────────────────────────────────┐    │
│ │                                             │    │
│ └─────────────────────────────────────────────┘    │
│                                                     │
│ 説明:                                               │
│ ┌─────────────────────────────────────────────┐    │
│ │                                             │    │
│ └─────────────────────────────────────────────┘    │
│                                                     │
│ 画像フォルダ:                                       │
│ ┌─────────────────────────────────┐ [参照...]     │
│ │ /path/to/images                 │               │
│ └─────────────────────────────────┘               │
│                                                     │
│ カテゴリ:                                           │
│ ┌─────────────────────────────────────────────┐    │
│ │ ● 人物                            [編集][×] │    │
│ │ ● 車                              [編集][×] │    │
│ │ [+ カテゴリを追加]                          │    │
│ └─────────────────────────────────────────────┘    │
│ [テンプレートから読込...]                           │
│                                                     │
├─────────────────────────────────────────────────────┤
│                      [キャンセル] [作成]            │
└─────────────────────────────────────────────────────┘
```

### カテゴリ編集ダイアログ

```
┌─────────────────────────────────────────────────────┐
│ カテゴリを編集                                [×]  │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 名前:                                               │
│ ┌─────────────────────────────────────────────┐    │
│ │ 人物                                        │    │
│ └─────────────────────────────────────────────┘    │
│                                                     │
│ 親カテゴリ:                                         │
│ ┌─────────────────────────────────────────────┐    │
│ │ なし                                    ▼   │    │
│ └─────────────────────────────────────────────┘    │
│                                                     │
│ 色:                                                 │
│ ┌────┐ #FF5733                                     │
│ │    │ [カラーピッカー]                            │
│ └────┘                                             │
│                                                     │
│ ショートカット:                                     │
│ ┌─────┐                                            │
│ │  1  │                                            │
│ └─────┘                                            │
│                                                     │
├─────────────────────────────────────────────────────┤
│                      [キャンセル] [保存]            │
└─────────────────────────────────────────────────────┘
```

### プロジェクト設定ダイアログ

```
┌─────────────────────────────────────────────────────┐
│ プロジェクト設定                              [×]  │
├─────────────────────────────────────────────────────┤
│ [基本] [カテゴリ] [保存] [エクスポート]            │
├─────────────────────────────────────────────────────┤
│                                                     │
│ （タブ内容）                                        │
│                                                     │
├─────────────────────────────────────────────────────┤
│                      [キャンセル] [保存]            │
└─────────────────────────────────────────────────────┘
```

## ステータスバー

### 配置

キャンバス下部

### モード別表示

#### 通常モード

```
┌─────────────────────────────────────────────────────────────────┐
│ 画像: 15/100 │ アノテーション: 25 │ ズーム: 100%                │
└─────────────────────────────────────────────────────────────────┘
```

#### 比較モード

```
┌─────────────────────────────────────────────────────────────────┐
│ 画像: 15/100 │ TP: 45 FP: 12 FN: 8 │ ズーム: 100%              │
└─────────────────────────────────────────────────────────────────┘
```

#### アノテーションモード

```
┌─────────────────────────────────────────────────────────────────┐
│ 画像: 15/100 │ アノテーション: 25 │ 選択: 2 │ ズーム: 100% │ ● │
└─────────────────────────────────────────────────────────────────┘
```

- 保存状態インジケータ（●:未保存, ○:保存済み）

## レスポンシブ対応

### デスクトップ（既存）

- 左右分割レイアウト
- サイドパネル表示

### タブレット

- サイドパネル折りたたみ可能
- ツールバー縮小表示

### モバイル

- ツールバーを下部に配置
- フローティングツールボタン
- サイドパネルはモーダル表示

## アクセシビリティ

### キーボード操作

- すべての機能にキーボードでアクセス可能
- Tab順序の適切な設定
- フォーカス表示

### スクリーンリーダー対応

- 適切なARIAラベル
- ステータス変更の通知

### 色覚多様性対応

- 色だけに依存しない情報表示
- ハイコントラストモード対応

## 通知

### トースト通知

- 既存のトースト機能を活用
- 成功: 緑色
- エラー: 赤色
- 警告: 黄色
- 情報: 青色

### 通知例

- 「プロジェクトを保存しました」
- 「アノテーションを削除しました」
- 「保存に失敗しました: ディスク容量不足」

## アニメーション

### 適用箇所

- モード切替時のUI遷移
- ダイアログの表示/非表示
- ツール選択時のハイライト
- ドラッグ＆ドロップ

### パフォーマンス

- CSS TransitionまたはtransformベースのアニメーションでGPUを活用
- 描画中はアニメーションを抑制
