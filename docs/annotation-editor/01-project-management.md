# プロジェクト管理機能 設計書

## 概要

アノテーション作業をプロジェクト単位で管理する機能を提供する。
プロジェクトには、カテゴリ定義、メタデータ、画像フォルダ参照、アノテーションデータが含まれる。

## プロジェクトの構成

### ファイル構造

```
<プロジェクトフォルダ>/
├── project.json              # プロジェクト設定ファイル
├── annotations.json          # アノテーションデータ（COCO形式）
└── backups/                  # 自動バックアップ
    ├── annotations_20241230_120000.json
    └── ...
```

### 画像フォルダとの関係

- プロジェクトは画像フォルダへの**参照**を持つ（画像をコピーしない）
- 既存のフォルダスキャン機能を活用
- 相対パス・絶対パスの両方に対応

## プロジェクト設定

### 基本情報

| 項目 | 説明 | 必須 |
|------|------|------|
| 名前 | プロジェクト名 | ○ |
| 説明 | プロジェクトの説明文 | - |
| 画像フォルダ | 対象画像が格納されているフォルダパス | ○ |
| 作成日時 | プロジェクト作成日時（自動設定） | ○ |
| 更新日時 | 最終更新日時（自動更新） | ○ |

### カテゴリ設定

各カテゴリには以下の属性を設定可能：

| 属性 | 説明 | 必須 |
|------|------|------|
| ID | カテゴリID（1以上の整数） | ○ |
| 名前 | カテゴリ名 | ○ |
| 親カテゴリ | supercategory（階層構造用） | - |
| 色 | 表示色（HEX形式） | - |
| ショートカット | キーボードショートカット（1-9, a-z） | - |

### プロジェクト設定オプション

| 項目 | 説明 | デフォルト |
|------|------|-----------|
| 自動保存 | 変更時に自動保存するか | ON |
| 自動保存間隔 | 自動保存の間隔（秒） | 60 |
| バックアップ保持数 | 保持するバックアップ数 | 10 |
| デフォルトカテゴリ | 新規アノテーション時のデフォルトカテゴリ | 最初のカテゴリ |

## 機能詳細

### プロジェクト作成

1. 新規プロジェクトダイアログを開く
2. プロジェクト名を入力
3. 画像フォルダを選択（既存のフォルダ選択機能を使用）
4. カテゴリを定義
   - 最低1つのカテゴリが必要
   - テンプレートからの読み込みも可能
5. プロジェクトフォルダの保存先を選択
6. プロジェクトを作成

### プロジェクトを開く

1. project.json ファイルを選択
2. プロジェクト設定を読み込み
3. 関連付けられた画像フォルダをスキャン
4. 既存のアノテーションを読み込み
5. アノテーションモードに切り替え

### プロジェクト設定の編集

- プロジェクト名・説明の編集
- カテゴリの追加・編集・削除
  - 使用中のカテゴリ削除時は警告を表示
- 画像フォルダの変更
- 設定オプションの変更

### 既存アノテーションのインポート

- 既存のCOCO JSONファイルをプロジェクトにインポート可能
- カテゴリマッピング機能
  - インポート元とプロジェクトのカテゴリをマッピング
  - 新規カテゴリの自動作成オプション

### エクスポート

- COCO JSON形式でエクスポート
- エクスポートオプション：
  - 全画像 or 選択画像のみ
  - アノテーションあり画像のみ
  - カテゴリフィルタ

## カテゴリ管理UI

### カテゴリ一覧

- ドラッグ＆ドロップで順序変更
- 一括操作（削除、色変更）
- 検索・フィルタ

### カテゴリ編集ダイアログ

- 名前入力
- 色選択（カラーピッカー or プリセット）
- ショートカット設定
- supercategory 選択

### カテゴリテンプレート

よく使われるカテゴリセットをテンプレートとして提供：

- COCO 80カテゴリ
- VOC 20カテゴリ
- カスタムテンプレートの保存・読込

## ワークフロー

### 新規プロジェクト開始

```
1. メニュー: ファイル → 新規プロジェクト
2. プロジェクト作成ダイアログ
   ├── プロジェクト名入力
   ├── 画像フォルダ選択
   ├── カテゴリ定義
   └── 保存先選択
3. プロジェクト作成完了
4. アノテーションモードに自動切替
5. 画像一覧表示、アノテーション開始
```

### 既存プロジェクトを開く

```
1. メニュー: ファイル → プロジェクトを開く
2. project.json を選択
3. プロジェクト読み込み
4. アノテーションモードに自動切替
5. 前回の作業状態を復元
```

### ビューモードとの連携

```
ビューモード:
- 通常のCOCO JSONを開いて閲覧
- 分析機能（ヒストグラム、ヒートマップ、比較）
- プロジェクトなしでも使用可能

アノテーションモード:
- プロジェクトが必須
- 編集機能が有効
- 保存・エクスポート機能
```

## 最近のプロジェクト

- 既存の最近のファイル機能を拡張
- プロジェクトファイルの履歴を保持
- 起動時に最近のプロジェクトを表示

## エラーハンドリング

### 画像フォルダが見つからない場合

1. 警告ダイアログを表示
2. フォルダの再選択を促す
3. 相対パスでの解決を試行

### アノテーションファイル破損時

1. バックアップからの復元を提案
2. 利用可能なバックアップ一覧を表示
3. 復元先を選択

### 保存失敗時

1. エラー内容を表示
2. 別名で保存を提案
3. 一時ファイルへの自動バックアップ
